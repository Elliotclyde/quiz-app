var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,s=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,r=(e,t)=>{for(var n in t||(t={}))l.call(t,n)&&s(e,n,t[n]);if(o)for(var n of o(t))i.call(t,n)&&s(e,n,t[n]);return e},u=(e,o)=>t(e,n(o));import{l as a,F as c,v as d,d as h,L as p,r as m,s as f,y as q,D as g,a as b,R as y,S as v}from"./vendor.eab9787a.js";function w({onAuthCallback:e}){const[t,n]=a(""),{user:o,setUser:l}=c(U);return console.log(o),d("div",{className:"modal-background"},d("div",{className:"modal"},d("h2",null,"Welcome!"),d("form",{onSubmit:function(n){n.preventDefault(),fetch("http://localhost:4000/create-user/",{headers:{"Content-Type":"application/json"},method:"POST",mode:"cors",body:JSON.stringify({name:t})}).then(((e,t)=>{if(e.ok)return e.json()})).then(((t,n)=>{document.getElementById("id").value&&(t.userId=parseInt(document.getElementById("id").value)),l(t),console.log(t),e&&e(t)}))}},d("label",{htmlFor:"new-name"},"Enter name:"),d("input",{type:"text",onChange:function(e){n(e.target.value)},value:t,name:"name",id:"new-name"})),d(h,null,d("label",{htmlFor:"id"},"User ID"),d("input",{id:"id",type:"number"}))))}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const z={title:"My quiz",user:null,questions:[{body:"What is the population of France?",answers:[{body:"65,453,399",isCorrect:!0},{body:"32,392,213",isCorrect:!1}]}]};function I(){const[e,t]=a(!1),{user:n}=c(U);function o(e){z.user=e,fetch("http://localhost:4000/create-quiz/",{headers:{"Content-Type":"application/json"},method:"POST",mode:"cors",body:JSON.stringify(z)}).then(((e,t)=>{if(e.ok)return e.json()})).then(((e,n)=>{console.log(e),t(!1),m("/editor/"+e.quizId)}))}return d("nav",null,d(p,{href:"/"},"Home"),d("button",{onClick:function(){n?o(n):t(!0)}},"Create"),d(p,{href:"/editor"},"Edit"),d(p,{href:"/host"},"Host"),e&&!n?d(w,{onAuthCallback:o}):null)}function C({data:e}){return d(h,null,d("h2",null,"Results"),d("div",null,e.quizers.map((t=>d(h,null,d("h3",null,t.name),d("table",null,d("tr",null,d("th",null,"Question"),d("th",null,"Answer"),d("th",null,"Result")),e.quiz.questions.map(((e,n)=>d("tr",null,d("td",null,e.body),d("td",null,t.answers[n].body),d("td",null,t.answers[n].isCorrect?"✔":"❌"))))),d("p",null,"Score: ",t.score))))))}function k({children:e}){return d("button",{onClick:function(e){console.log(e.target.innerText),navigator.clipboard.writeText(e.target.innerText)}},e)}function S({data:e}){return console.log(e.quizers[0]),d(h,null,d("h2",null,"Players"),d("div",null,d("table",null,d("tr",null,d("th",null,"Player"),d("th",null,"Result"),d("th",null,"Connected")),e.quizers.map((e=>d("tr",null,d("td",null,e.name),d("td",null,e.hasAnswered?e.answers[e.answers.length-1].isCorrect?"✔":"❌":"..."),d("td",null,e.connected?"connected":"disconnected")))))))}const O=(e,t)=>e.score>t.score?-1:e.score<t.score?1:0;let j;function T({roomId:e}){var t;const{user:n}=c(U),[o,l]=a(null),[i,s]=a("loading");f("loading");const r=(null==o?void 0:o.quizers)||[],u=(null==o?void 0:o.host)===(null==n?void 0:n.userId),p=o?o.quiz.questions[o.currentQuestionIndex]:null,m=o?null==(t=o.quizers.filter((e=>e.userId==(null==n?void 0:n.userId)))[0])?void 0:t.hasAnswered:null,g=!!o&&(o.hostConnected&&0===o.quizers.filter((e=>!e.connected)).length);function b(e){const t=JSON.parse(e.data);switch(t.type){case"host":t.hasStarted?s("quizzing"):s("waiting"),l(t);break;case"start":s("quizzing"),l(t);break;case"join":t.hasStarted?s("quizzing"):s("waiting"),l(t);break;case"disconnect":case"nextQuestion":l(t);break;case"failure":break;case"answer":l(t),t.currentQuestionIndex>=t.quiz.questions.length&&(s("end"),j.removeEventListener("message",b),j.close())}}function y(){fetch("http://localhost:4000/start-quiz",{headers:{"Content-Type":"application/json"},method:"POST",mode:"cors",body:JSON.stringify({roomId:e})}).then(((e,t)=>e.json())).then(((e,t)=>{console.log(e)}))}return q((()=>{if(n)return j=new EventSource("http://localhost:4000/join-quiz/"+e+"/"+n.userId),j.addEventListener("message",b),()=>{j.removeEventListener("message",b),j.close()}}),[n,e]),d("div",null,null==n?d(w,null):"",(()=>{switch(i){case"loading":return" . . . ";case"waiting":return d(h,null,u?d(h,null,d("h2",null,"Waiting for quizers..."),d("p",null,"You're hosting"),d("p",null,"Send your friends this link to join:"),d(k,null,"http://localhost:4000/quiz/"+e)):o.hostConnected?d("h2",null,"Waiting for host to start the quiz"):d("h2",null,"Host disconnected. Waiting for them to reconnect."),d("div",null,d("h3",null,"Current quizers:"),0==r.length?"Noone's joined the quiz yet!":r.map((e=>e.userId==n.userId?d("p",null,"You are ready to quiz"):e.connected?d("p",null,e.name.charAt(0).toUpperCase()+e.name.slice(1)," ","is ready to quiz"):d("p",null,e.name.charAt(0).toUpperCase()+e.name.slice(1)," ","has disconnected")))),u?d("button",{disabled:0==(null==o?void 0:o.quizers.length)||!g,onClick:y},"Start quiz"):null);case"quizzing":return u?d(h,null,d("h2",null,"Quizers are on question ",o.currentQuestionIndex+1),d(S,{data:o})):d(h,null,d("h2",null,"Question ",o.currentQuestionIndex+1),d("h3",null,p.body),p.answers.map(((t,o)=>d("button",{disabled:m||!g,onClick:()=>{var t;t=o,fetch("http://localhost:4000/answer/",{headers:{"Content-Type":"application/json"},method:"POST",mode:"cors",body:JSON.stringify({roomId:e,user:n,answerIndex:t})})}},t.body))),d(S,{data:o}));case"end":return r.sort(O)[0],d(h,null,d("h2",null,function(e,t){const n=e.sort(O),o=n.filter((e=>e.score===n[0].score));return 1==o.length?n[0].userId==t.userId?"You win!":"The winner is: "+n[0].name:"It was a draw between: "+o.map((e=>e.name)).join(", ")}(r,n)),d(C,{data:o}))}})())}function N({roomId:e}){return d(h,null,d(I,null),d("div",null,d(T,{roomId:e})))}function x(){return d(h,null,d(I,null),d("div",null,d("h1",null,"Open-quiz"),d("ul",null,d("li",null,"Make a quiz"),d("li",null,"Invite your friends"),d("li",null,"Test their knowledge"))))}const D=(e,t,n=[])=>{const[o,l]=a(null);return q((()=>{t&&fetch(e).then((function(e){if(!e.ok)throw Error(e.statusText);return e.json()})).then((function(e){console.log(e),l(e)})).catch((function(e){console.log(e),console.log("Looks like there was a problem: \n",e)}))}),[e,...n]),o};function P({listData:e}){return d("div",null,e.map((e=>d(h,null,d("h2",null,e.title),d("p",null,d("a",{href:"./editor/"+e.quizId}," Edit this quiz"))))))}function E({onDeleteCallback:e}){return d("div",{className:"modal-background"},d("div",{className:"modal"},d("h2",null,"Delete this quiz?"),d("button",{onClick:()=>e(!0)},"Yes"),d("button",{onClick:()=>e(!1)},"No")))}function L({quizId:e}){const{user:t}=c(U);console.log(e);const n=D("http://localhost:4000/get-quiz/"+e,""!==e),o=D("http://localhost:4000/get-user-quizes/"+(null==t?void 0:t.userId),""===e&&t,[e]);return d(h,null,d(I,null),d("div",{className:"quiz-edit-wrapper"},d("h1",null,"Quiz editor"),""!=e?null!=n?d(Q,{initialData:n,user:t,quizId:e}):d("p",null,"Loading . . ."):d(h,null,null==t?d(w,null):"",d("h1",null,"Select quiz to edit"),null!=o?d(P,{listData:o}):d("p",null,"Loading . . ."))))}function Q({initialData:e,quizId:t,user:n}){const[o,l]=a(e),[i,s]=a(!1);return q((()=>{console.log(o)})),d(h,null,i?d(E,{onDeleteCallback:function(e){e?fetch("http://localhost:4000/delete-quiz/"+t,{headers:{"Content-Type":"application/json"},method:"POST",mode:"cors",body:JSON.stringify(o)}).then(((e,t)=>e.json())).then(((e,t)=>{console.log("here"),"deleted"===e.result&&(window.location.href="http://localhost:4000/editor")})):s(!1)}}):"",d("form",{onSubmit:function(e){e.preventDefault(),console.log(JSON.stringify(o)),fetch("http://localhost:4000/edit-quiz/"+t,{headers:{"Content-Type":"application/json"},method:"POST",mode:"cors",body:JSON.stringify(o)})},action:"",method:"post"},d("div",{className:"title-input-wrapper"},d("label",{className:"title-input-label",htmlFor:"title-input"},"Title:"),d("input",{id:"title-input",type:"text",value:o.title,name:"title",onInput:function(e){l((t=>u(r({},t),{title:e.target.value})))}})),o.questions.map(((e,t)=>d("div",{key:t},d("div",{className:"question-input-wrapper"},d("label",{htmlFor:"question-input-text-"+t},"Question ",t+1,":"),d("input",{className:"question-input",id:"question-input-text-"+t,type:"text",name:"questionInputText"+t,onInput:e=>{!function(e,t){l((n=>u(r({},n),{questions:n.questions.map(((n,o)=>o==t?u(r({},n),{body:e.target.value}):n))})))}(e,t)},value:e.body})),e.answers.map(((n,o)=>d("div",{key:o},d("label",{htmlFor:"answer-input-text-"+o},"Answer ",o+1,":"),d("input",{id:"answer-input-text-"+o,type:"text",name:"answerInputText"+o,onInput:e=>{!function(e,t,n){l((o=>u(r({},o),{questions:o.questions.map(((l,i)=>i==t?u(r({},l),{answers:o.questions[t].answers.map(((t,o)=>o==n?u(r({},t),{body:e.target.value}):t))}):l))})))}(e,t,o)},value:n.body}),d("label",{htmlFor:"answer-input-is-correct-"+o},"Correct?"),d("input",{id:"answer-input-is-correct-"+o,type:"checkbox",name:"answerInputIsCorrect"+o,checked:n.isCorrect,onChange:e=>{!function(e,t,n){l((o=>u(r({},o),{questions:o.questions.map(((o,l)=>l==e?u(r({},o),{answers:o.answers.map(((e,o)=>u(r({},e),o===t?{isCorrect:"on"==n}:{isCorrect:!1})))}):o))})))}(t,o,e.target.value)}}),d("button",{disabled:e.answers.length<=2,onClick:e=>{!function(e,t,n){e.preventDefault(),l((e=>u(r({},e),{questions:[...e.questions.map(((e,o)=>o!=t?e:u(r({},e),{answers:e.answers.filter(((e,t)=>t!=n))})))]})))}(e,t,o)}},"Remove Answer")))),d("button",{disabled:e.answers.length>=4,onClick:e=>{!function(e,t){e.preventDefault(),l((e=>u(r({},e),{questions:e.questions.map(((e,n)=>n==t?u(r({},e),{answers:[...e.answers,{body:"",isCorrect:!1}]}):e))})))}(e,t)}},"Add answer"),d("button",{disabled:o.questions.length<=1,onClick:e=>{!function(e,t){l((e=>u(r({},e),{questions:[...e.questions.filter(((e,n)=>n!=t))]})))}(0,t)}},"Remove Question")))),d("button",{onClick:function(e){e.preventDefault(),l((e=>u(r({},e),{questions:[...e.questions,{body:"",answers:[{body:"",isCorrect:!0},{body:"",isCorrect:!1}]}]})))}},"Add Question"),d("div",{className:"save-wrapper"},d("input",{type:"submit",value:"Save"}),d("button",{onClick:function(e){e.preventDefault(),fetch("http://localhost:4000/host-quiz",{body:JSON.stringify({userId:n.userId,quizId:parseInt(t)}),headers:{"Content-Type":"application/json"},method:"POST"}).then((function(e){if(!e.ok)throw Error(e.statusText);return e.json()})).then((function(e){console.log(e),m("/quiz/"+e.roomId)})).catch((function(e){console.log(e),console.log("Looks like there was a problem: \n",e)}))}},"Save and host"))),d("button",{onClick:()=>{s(!0)}},"Delete quiz"))}function A({listData:e}){const{user:t}=c(U),n=e.filter((e=>e.quizUser===(null==t?void 0:t.userId)));function o(e){e.preventDefault(),fetch("http://localhost:4000/host-quiz",{body:JSON.stringify({userId:t.userId,quizId:parseInt(e.target.dataset.quizid)}),headers:{"Content-Type":"application/json"},method:"POST"}).then((function(e){if(!e.ok)throw Error(e.statusText);return e.json()})).then((function(e){console.log(e),m("/quiz/"+e.roomId)})).catch((function(e){console.log(e),console.log("Looks like there was a problem: \n",e)}))}return d("div",null,n.map((e=>d(h,null,d("h2",null,e.title),d("p",null,d("a",{onClick:o,"data-quizid":e.quizId,href:"./quiz/"+e.quizId}," ","Host this quiz"))))))}function J(){const{user:e}=c(U),t=D("http://localhost:4000/get-quiz/",!0);return d(h,null,d(I,null),null==e?d(w,null):"",t?d("div",null,d("h1",null,"Quizes"),d(A,{listData:t})):d("div",null,"Loading quizes . . ."))}const U=g({user:null,setUser:()=>{}});function F(e){const[t,n]=a(window.inMemoryUser),o=b((()=>({user:t,setUser:e=>{n(e)}})),[t]);return d(U.Provider,{value:o},d(y,null,d(x,{path:"/"}),d(L,{path:"/editor/:quizId?"}),d(J,{path:"/host/:quizId?"}),d(N,{path:"/quiz/:roomId?"})))}window.inMemoryUser=null;v(d(F,null),document.getElementById("app")),document.title="Quiz app";
