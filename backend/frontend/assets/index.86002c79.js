var e=Object.defineProperty,n=Object.defineProperties,t=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,u=(n,t,o)=>t in n?e(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,r=(e,n)=>{for(var t in n||(n={}))i.call(n,t)&&u(e,t,n[t]);if(o)for(var t of o(n))l.call(n,t)&&u(e,t,n[t]);return e},s=(e,o)=>n(e,t(o));import{l as a,F as c,v as d,L as p,r as h,d as m,s as f,y as q,D as z,a as g,R as b,S as y}from"./vendor.eab9787a.js";function v({onAuthCallback:e}){const[n,t]=a(""),{user:o,setUser:i}=c(U);return console.log(o),d("div",{className:"modal-background"},d("div",{className:"modal"},d("h2",null,"Welcome!"),d("form",{onSubmit:function(t){t.preventDefault(),fetch("https://open-quiz-nz.glitch.me/create-user/",{headers:{"Content-Type":"application/json"},method:"POST",mode:"cors",body:JSON.stringify({name:n})}).then(((e,n)=>{if(e.ok)return e.json()})).then(((n,t)=>{i(n),console.log(n),e&&e(n)}))}},d("label",{htmlFor:"new-name"},"Enter name:"),d("input",{type:"text",onChange:function(e){t(e.target.value)},value:n,name:"name",id:"new-name"})),null))}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&n(e)})).observe(document,{childList:!0,subtree:!0})}function n(e){if(e.ep)return;e.ep=!0;const n=function(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerpolicy&&(n.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?n.credentials="include":"anonymous"===e.crossorigin?n.credentials="omit":n.credentials="same-origin",n}(e);fetch(e.href,n)}}();const w={title:"My quiz",user:null,questions:[{body:"What is the population of France?",answers:[{body:"65,453,399",isCorrect:!0},{body:"32,392,213",isCorrect:!1}]}]};function I(){const[e,n]=a(!1),{user:t}=c(U);function o(e){w.user=e,fetch("https://open-quiz-nz.glitch.me/create-quiz/",{headers:{"Content-Type":"application/json"},method:"POST",mode:"cors",body:JSON.stringify(w)}).then(((e,n)=>{if(e.ok)return e.json()})).then(((e,t)=>{n(!1),h("/editor/"+e.quizId)}))}return d("nav",null,d(p,{href:"/"},"Home"),d("button",{onClick:function(){t?o(t):n(!0)}},"Create"),d(p,{href:"/editor"},"Edit"),d(p,{href:"/host"},"Host"),e&&!t?d(v,{onAuthCallback:o}):null)}function C({data:e}){return d(m,null,d("h2",null,"Results"),d("div",null,e.quizers.map((n=>d(m,null,d("h3",null,n.name),d("table",null,d("tr",null,d("th",null,"Question"),d("th",null,"Answer"),d("th",null,"Result")),e.quiz.questions.map(((e,t)=>d("tr",null,d("td",null,e.body),d("td",null,n.answers[t].body),d("td",null,n.answers[t].isCorrect?"✔":"❌"))))),d("p",null,"Score: ",n.score))))))}function k({children:e}){return d("button",{onClick:function(e){navigator.clipboard.writeText(e.target.innerText)}},e)}function S({data:e}){return d(m,null,d("h2",null,"Players"),d("div",null,d("table",null,d("tr",null,d("th",null,"Player"),d("th",null,"Result"),d("th",null,"Connected")),e.quizers.map((e=>d("tr",null,d("td",null,e.name),d("td",null,e.hasAnswered?e.answers[e.answers.length-1].isCorrect?"✔":"❌":"..."),d("td",null,e.connected?"connected":"disconnected")))))))}const O=(e,n)=>e.score>n.score?-1:e.score<n.score?1:0;let j;function N({roomId:e}){var n;const{user:t}=c(U),[o,i]=a(null),[l,u]=a("loading");f("loading");const r=(null==o?void 0:o.quizers)||[],s=(null==o?void 0:o.host)===(null==t?void 0:t.userId),p=o?o.quiz.questions[o.currentQuestionIndex]:null,h=o?null==(n=o.quizers.filter((e=>e.userId==(null==t?void 0:t.userId)))[0])?void 0:n.hasAnswered:null,z=!!o&&(o.hostConnected&&0===o.quizers.filter((e=>!e.connected)).length);function g(e){const n=JSON.parse(e.data);switch(n.type){case"host":n.hasStarted?u("quizzing"):u("waiting"),i(n);break;case"start":u("quizzing"),i(n);break;case"join":n.hasStarted?u("quizzing"):u("waiting"),i(n);break;case"disconnect":case"nextQuestion":i(n);break;case"failure":break;case"answer":i(n),n.currentQuestionIndex>=n.quiz.questions.length&&(u("end"),j.removeEventListener("message",g),j.close())}}function b(){fetch("https://open-quiz-nz.glitch.me/start-quiz",{headers:{"Content-Type":"application/json"},method:"POST",mode:"cors",body:JSON.stringify({roomId:e})}).then(((e,n)=>e.json())).then(((e,n)=>{console.log(e)}))}return q((()=>{if(t)return j=new EventSource("https://open-quiz-nz.glitch.me/join-quiz/"+e+"/"+t.userId),j.addEventListener("message",g),()=>{j.removeEventListener("message",g),j.close()}}),[t,e]),d("div",null,null==t?d(v,null):"",(()=>{switch(l){case"loading":return" . . . ";case"waiting":return d(m,null,s?d(m,null,d("h2",null,"Waiting for quizers..."),d("p",null,"You're hosting"),d("p",null,"Send your friends this link to join:"),d(k,null,"https://open-quiz-nz.glitch.me/quiz/"+e)):o.hostConnected?d("h2",null,"Waiting for host to start the quiz"):d("h2",null,"Host disconnected. Waiting for them to reconnect."),d("div",null,d("h3",null,"Current quizers:"),0==r.length?"Noone's joined the quiz yet!":r.map((e=>e.userId==t.userId?d("p",null,"You are ready to quiz"):e.connected?d("p",null,e.name.charAt(0).toUpperCase()+e.name.slice(1)," ","is ready to quiz"):d("p",null,e.name.charAt(0).toUpperCase()+e.name.slice(1)," ","has disconnected")))),s?d("button",{disabled:0==(null==o?void 0:o.quizers.length)||!z,onClick:b},"Start quiz"):null);case"quizzing":return s?d(m,null,d("h2",null,"Quizers are on question ",o.currentQuestionIndex+1),d(S,{data:o})):d(m,null,d("h2",null,"Question ",o.currentQuestionIndex+1),d("h3",null,p.body),p.answers.map(((n,o)=>d("button",{disabled:h||!z,onClick:()=>{var n;n=o,fetch("https://open-quiz-nz.glitch.me/answer/",{headers:{"Content-Type":"application/json"},method:"POST",mode:"cors",body:JSON.stringify({roomId:e,user:t,answerIndex:n})})}},n.body))),d(S,{data:o}));case"end":return r.sort(O)[0],d(m,null,d("h2",null,function(e,n){const t=e.sort(O),o=t.filter((e=>e.score===t[0].score));return 1==o.length?t[0].userId==n.userId?"You win!":"The winner is: "+t[0].name:"It was a draw between: "+o.map((e=>e.name)).join(", ")}(r,t)),d(C,{data:o}))}})())}function T({roomId:e}){return d(m,null,d(I,null),d("div",null,d(N,{roomId:e})))}function x(){return d(m,null,d(I,null),d("div",null,d("h1",null,"Open-quiz"),d("ul",null,d("li",null,"Make a quiz"),d("li",null,"Invite your friends"),d("li",null,"Test their knowledge"))))}const D=(e,n,t=[])=>{const[o,i]=a(null);return q((()=>{n&&fetch(e).then((function(e){if(!e.ok)throw Error(e.statusText);return e.json()})).then((function(e){console.log(e),i(e)})).catch((function(e){console.log(e),console.log("Looks like there was a problem: \n",e)}))}),[e,...t]),o};function P({listData:e}){return d("div",null,e.map((e=>d(m,null,d("h2",null,e.title),d("p",null,d("a",{href:"./editor/"+e.quizId}," Edit this quiz"))))))}function Q({onDeleteCallback:e}){return d("div",{className:"modal-background"},d("div",{className:"modal"},d("h2",null,"Delete this quiz?"),d("button",{onClick:()=>e(!0)},"Yes"),d("button",{onClick:()=>e(!1)},"No")))}function E({quizId:e}){const{user:n}=c(U),t=D("https://open-quiz-nz.glitch.me/get-quiz/"+e,""!==e),o=D("https://open-quiz-nz.glitch.me/get-user-quizes/"+(null==n?void 0:n.userId),""===e&&n,[e]);return d(m,null,d(I,null),d("div",{className:"quiz-edit-wrapper"},d("h1",null,"Quiz editor"),""!=e?null!=t?d(A,{initialData:t,user:n,quizId:e}):d("p",null,"Loading . . ."):d(m,null,null==n?d(v,null):"",d("h1",null,"Select quiz to edit"),null!=o?d(P,{listData:o}):d("p",null,"Loading . . ."))))}function A({initialData:e,quizId:n,user:t}){const[o,i]=a(e),[l,u]=a(!1);return d(m,null,l?d(Q,{onDeleteCallback:function(e){e?fetch("https://open-quiz-nz.glitch.me/delete-quiz/"+n,{headers:{"Content-Type":"application/json"},method:"POST",mode:"cors",body:JSON.stringify(o)}).then(((e,n)=>e.json())).then(((e,n)=>{"deleted"===e.result&&(window.location.href="https://open-quiz-nz.glitch.me/editor")})):u(!1)}}):"",d("form",{onSubmit:function(e){e.preventDefault(),fetch("https://open-quiz-nz.glitch.me/edit-quiz/"+n,{headers:{"Content-Type":"application/json"},method:"POST",mode:"cors",body:JSON.stringify(o)})},action:"",method:"post"},d("div",{className:"title-input-wrapper"},d("label",{className:"title-input-label",htmlFor:"title-input"},"Title:"),d("input",{id:"title-input",type:"text",value:o.title,name:"title",onInput:function(e){i((n=>s(r({},n),{title:e.target.value})))}})),o.questions.map(((e,n)=>d("div",{key:n},d("div",{className:"question-input-wrapper"},d("label",{htmlFor:"question-input-text-"+n},"Question ",n+1,":"),d("input",{className:"question-input",id:"question-input-text-"+n,type:"text",name:"questionInputText"+n,onInput:e=>{!function(e,n){i((t=>s(r({},t),{questions:t.questions.map(((t,o)=>o==n?s(r({},t),{body:e.target.value}):t))})))}(e,n)},value:e.body})),e.answers.map(((t,o)=>d("div",{key:o},d("label",{htmlFor:"answer-input-text-"+o},"Answer ",o+1,":"),d("input",{id:"answer-input-text-"+o,type:"text",name:"answerInputText"+o,onInput:e=>{!function(e,n,t){i((o=>s(r({},o),{questions:o.questions.map(((i,l)=>l==n?s(r({},i),{answers:o.questions[n].answers.map(((n,o)=>o==t?s(r({},n),{body:e.target.value}):n))}):i))})))}(e,n,o)},value:t.body}),d("label",{htmlFor:"answer-input-is-correct-"+o},"Correct?"),d("input",{id:"answer-input-is-correct-"+o,type:"checkbox",name:"answerInputIsCorrect"+o,checked:t.isCorrect,onChange:e=>{!function(e,n,t){i((o=>s(r({},o),{questions:o.questions.map(((o,i)=>i==e?s(r({},o),{answers:o.answers.map(((e,o)=>s(r({},e),o===n?{isCorrect:"on"==t}:{isCorrect:!1})))}):o))})))}(n,o,e.target.value)}}),d("button",{disabled:e.answers.length<=2,onClick:e=>{!function(e,n,t){e.preventDefault(),i((e=>s(r({},e),{questions:[...e.questions.map(((e,o)=>o!=n?e:s(r({},e),{answers:e.answers.filter(((e,n)=>n!=t))})))]})))}(e,n,o)}},"Remove Answer")))),d("button",{disabled:e.answers.length>=4,onClick:e=>{!function(e,n){e.preventDefault(),i((e=>s(r({},e),{questions:e.questions.map(((e,t)=>t==n?s(r({},e),{answers:[...e.answers,{body:"",isCorrect:!1}]}):e))})))}(e,n)}},"Add answer"),d("button",{disabled:o.questions.length<=1,onClick:e=>{!function(e,n){i((e=>s(r({},e),{questions:[...e.questions.filter(((e,t)=>t!=n))]})))}(0,n)}},"Remove Question")))),d("button",{onClick:function(e){e.preventDefault(),i((e=>s(r({},e),{questions:[...e.questions,{body:"",answers:[{body:"",isCorrect:!0},{body:"",isCorrect:!1}]}]})))}},"Add Question"),d("div",{className:"save-wrapper"},d("input",{type:"submit",value:"Save"}),d("button",{onClick:function(e){e.preventDefault(),fetch("https://open-quiz-nz.glitch.me/host-quiz",{body:JSON.stringify({userId:t.userId,quizId:parseInt(n)}),headers:{"Content-Type":"application/json"},method:"POST"}).then((function(e){if(!e.ok)throw Error(e.statusText);return e.json()})).then((function(e){h("/quiz/"+e.roomId)})).catch((function(e){console.log(e)}))}},"Save and host"))),d("button",{onClick:()=>{u(!0)}},"Delete quiz"))}function L({listData:e}){const{user:n}=c(U),t=e.filter((e=>e.quizUser===(null==n?void 0:n.userId)));function o(e){e.preventDefault(),fetch("https://open-quiz-nz.glitch.me/host-quiz",{body:JSON.stringify({userId:n.userId,quizId:parseInt(e.target.dataset.quizid)}),headers:{"Content-Type":"application/json"},method:"POST"}).then((function(e){if(!e.ok)throw Error(e.statusText);return e.json()})).then((function(e){h("/quiz/"+e.roomId)})).catch((function(e){console.log(e)}))}return d("div",null,t.map((e=>d(m,null,d("h2",null,e.title),d("p",null,d("a",{onClick:o,"data-quizid":e.quizId,href:"./quiz/"+e.quizId}," ","Host this quiz"))))))}function J(){const{user:e}=c(U),n=D("https://open-quiz-nz.glitch.me/get-quiz/",!0);return d(m,null,d(I,null),null==e?d(v,null):"",n?d("div",null,d("h1",null,"Quizes"),d(L,{listData:n})):d("div",null,"Loading quizes . . ."))}const U=z({user:null,setUser:()=>{}});function F(e){const[n,t]=a(JSON.parse(window.localStorage.getItem("user"))),o=g((()=>({user:n,setUser:e=>{window.localStorage.setItem("user",JSON.stringify(e)),t(e)}})),[n]);return d(U.Provider,{value:o},d(b,null,d(x,{path:"/"}),d(E,{path:"/editor/:quizId?"}),d(J,{path:"/host/:quizId?"}),d(T,{path:"/quiz/:roomId?"})))}window.inMemoryUser=null;y(d(F,null),document.getElementById("app")),document.title="Quiz app";
